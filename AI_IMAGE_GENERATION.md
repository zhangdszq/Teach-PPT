# AI图片生成功能说明

## 功能概述

当前端调用 `/use` 接口应用PPT模板后，系统会自动检测具有 `alt` 属性和内容的图片组件，并调用AI生成图片功能重新渲染替换图片。

## 实现方案

### 1. 后端处理 (`TemplateService.java`)

在 `useTemplateWithAIData` 方法中：
- 模板应用时会为具有 `alt` 属性的图片设置AI生成的描述内容
- `itemFigure` 类型的图片会按行优先顺序匹配AI图片描述
- 如果AI描述不足，相应的图片元素会被标记为移除

### 2. 前端AI图片生成Hook (`useTemplateAIImage.ts`)

提供以下功能：
- `processTemplateImages()`: 批量处理所有具有alt属性的图片元素
- `hasTemplateImages()`: 检查是否有需要处理的图片
- `getTemplateImageCount()`: 获取需要处理的图片数量
- 支持进度显示和错误处理

### 3. 模板应用集成 (`Canvas/index.vue`)

在 `handleManualTemplateSelect` 方法中：
- 模板应用成功后自动检测图片元素
- 如果发现具有alt属性的图片，自动调用AI生成功能
- 提供用户友好的进度提示

## 使用流程

1. **用户选择模板**: 在模板选择对话框中选择合适的模板
2. **应用模板**: 系统调用 `/use` 接口，后端处理模板数据并设置图片描述
3. **自动检测**: 前端检测到具有alt属性的图片元素
4. **AI生成**: 自动调用AI图片生成接口，批量处理所有图片
5. **更新显示**: 生成的图片自动替换原有占位图片

## 技术特点

- **自动化**: 模板应用后无需手动操作，自动开始图片生成
- **批量处理**: 支持同时处理多个图片元素
- **进度显示**: 实时显示生成进度和结果统计
- **错误处理**: 对生成失败的图片进行错误提示
- **类型安全**: 使用TypeScript确保类型安全

## API接口

### AI图片生成接口
```typescript
API.AI_Image({ 
  prompt: string,    // 图片描述
  model: 'jimeng'    // 使用的AI模型
})
```

### 响应格式
```json
{
  "status": "success",
  "data": {
    "image_url": "生成的图片URL"
  }
}
```

## 组件使用

### 独立按钮组件
```vue
<TemplateAIImageButton />
```

### 在Canvas中集成
模板应用成功后会自动触发，无需额外操作。

## 注意事项

1. 只处理具有 `alt` 属性且内容不为空的图片元素
2. 排除标记为 `REMOVE_THIS_ELEMENT` 的图片元素
3. 使用即梦(jimeng)模型进行图片生成
4. 生成失败的图片会保持原状，不影响其他图片的生成
5. 支持并发生成，提高处理效率

## 扩展功能

- 可以添加不同的AI模型选择
- 支持图片生成参数配置
- 添加图片质量和尺寸控制
- 支持重新生成功能